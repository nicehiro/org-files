#+TITLE: 计算机网络总结
#+OPTIONS: toc:nil
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="/home/hiro/Documents/org-files/worg.css"/>
#+DATE: 2018-11-01

* 计算机网络体系结构
1. 计算机网络最重要的功能：连通性、共享
2. Internet特指因特网，采用TCP/IP，前身时美国的ARPANET
3. IXP因特网交换点，工作在数据链路层，通过交换机实现两个网络直接相连交换分组
4. 带宽 最高数据率，通路传输数据的能力
5. 网络利用率 \(D = \frac{D_0}{1-U}\)，D目前网络时延
6. 协议时水平的，使用本层服务的实体只能看见服务而无法看见下面的协议，协议时透明的
7. IP是最核心的
8. 通信子网下三层，传输层介于中间，上三层是资源子网
9. 局域网采用广播技术
10. 高速链路指发送速度（传输数度）变快
11. 计算机网络拓扑结构主要取决于它的通信子网
12. 可靠服务 保证数据能准确、可靠的传送；不能保证数据是不是己方传送的
13. ISO的OSI在网络层支持面向连接和无连接，传输层只有面向连接；而TCP/IP传输层有面向连接和无连接，网络层只有面向无连接
14. OSI七层：物理层，数据链路层，网络层，传输层，表示层（数据结构的表示），会话层（多个端口间的通信），应用层
15. TCP/IP四层：网络接口层，网络层，传输层，应用层
16. 只有网络层和传输层具有涌塞控制功能
* 物理层
1. 模拟信号（数据） 连续变化的数据；数字信号（数据） 离散值
2. 信源 发送数据的源头；信宿 接受数据的终点；信道 信号的传输媒介
3. 噪声源 信道上的噪声以及分散在通信系统上的噪声的集中表示
4. 模拟信道 传输模拟信号；数字信道 传输数字信号
5. 基带传输 将数字信号直接传送到数字信道上传输；宽带（频带）传输 将数字信号调制后形成模拟信号传送到模拟信道上传输
6. 信道的极限容量 信道的最高码元传输速率（Baud，波特）或信道的极限数据传输速率（bit）
7. 带宽 单位时间所能传输的最高数据率（bit/s）
8. 奈奎斯特（Nyquist）定理 理想低通信道中，极限码元传输率为 2W Baud，W 为理想低通信道带宽（Hz）
9. 香农定理（Shannon） 带宽受限且有高斯白噪声干扰的信道的极限数据传输速率 \(Wlog_2(1+S/N) b/s\) W 信道的带宽；S信道传输信道的平均功率；N高斯噪声功率；信噪比=\(10log_{10}(S/N) dB\)
10. 编码 数据转换为数字信号；调制 数据转换为模拟信号
11.
      | 编码种类       | 编码方式            | 详情                                                           |
      |----------------+---------------------+----------------------------------------------------------------|
      | 数字编码为数字 | 非归零码（NRZ）     | 低电平0，高电平1                                               |
      | ^^             | 曼彻斯特编码        | 高低1，低高0，中间的跳变信号可用作时钟信号（同步）；以太网使用 |
      | ^^             | 差分曼彻斯特        | 若码元为1，则前半个码元和上个码元相同；局域网使用              |
      | ^^             | 4B/5B编码           | 4B的信息使用5B的码元表示                                       |
      | 数字调制为模拟 | 幅移键控（ASK）     | 1有幅度，0没幅度                                               |
      | ^^             | 频移键控（FSK）     | 1和0对应的频率不同                                             |
      | ^^             | 相移键控（PSK）     | 1和0对应的相位不同                                             |
      | ^^             | 正交振幅调制（QAM） | ASK和PSK结合，数据传输率R=波特率B\(log_2(相位m*振幅n)\)        |
      | 模拟编码为数字 | 脉码调制（PCM）     | 抽样，量化，编码；采样频率大于等于最大频率的两倍               |
      | 模拟调制为模拟 |                     | 电话机和本地交换机传输的信号                                   |
12. 电路交换 适用于传输模拟信号和数字信号；除了源结点和目的结点，任何结点都采取直通式接受和发送数据
13. 报文交换 无需建立连接，动态分配电路，需要存储转发整个报文段
14. 分组交换 分成小块传输
    - 数据报 无需建立连接 可能丢失分组、乱序；每个分组需要包括发送方和接受方的完整地址；每个分组独立的进行路由选择和转发，不保证可靠通信，用户主机流量控制
    - 虚电路 先建立虚拟连接 分组首部不包含目的地址而是分组标识，有序，可靠性由网络保证，可以由网络或者用户主机流量控制
15. 混淆点 比特率 波特率 数据率 \(比特率=波特率*log_2n，每个码元有n个有效值，如果一个数据由两个电平表示，那么比特率是数据率的2倍\)
16. 双绞线
    - 绞合可以减少相邻导线的干扰
    - STP 屏蔽双绞线，UTP 非屏蔽双绞线
    - 模拟传输使用放大器放大；数字传输使用中继器整形
17. 同轴电缆 50\(\Omega\)用于传输基带数字信号，称基带同轴电缆，在局域网中使用；70\(\Omega\)用于有线电视传输宽带信号（模拟）；带宽高得易于它的高屏蔽性
18. 光纤 单模光纤使用定向性很好的激光二极管，适合远距离传输；多模光纤只适合近距离传输
19. 无线传输 无线电波（WLAN）；微波，红外线，激光（沿直线传播，视线通路）
20. 卫星传播具有成本高，传播时延高，受气候影响大，保密性差，误码率高的特点
21. 物理层接口特性
    - 机械特性 接插装置的规格，引脚数，排列等
    - 电气特性 信号的电压高低，传输速率等；多高的电压算高电平
    - 功能特性 出现某一电平电压的意义
    - 规程特性 物理线路的工作规程和时序关系
22. 中继器（转发器） 将数字信号整形放大；不能无线增大中继器的个数，5-4-3 规则 4个中继器连接的5个网段中只有3个段可以挂接计算机
23. 集线器（Hub） 多端口的中继器，逻辑上仍然是一个总线网，Hub只能在半双工下工作，流量平分到不同的网段
24. 两个网段在物理层互联要求数据传输率相同；两个网段在数据链路层互联要求数据传输率和链路层协议都相同
* 数据链路层
1. 有连接一定有确认。无确认的无连接服务适用于 *实时通信或误码率较低* 的通信（比如以太网）；有确认无连接的通信适用于误码率较高的通信；有确认有连接的通信适用于可靠性要求高的通信
2. 链路管理 数据链路层连接的建立、维持和释放的过程
3. 帧定界 将网络层的IP数据报添加首部和尾部，确定帧的界限
4. 帧同步 确保接受方可以识别帧的帧的起始和终止
5. 透明传输 不管传输什么样的比特组合，都可以在链路上传输
6. 流量控制 使发送方控制自己发送数据的速率
   - 停止等待协议
   - 滑动窗口流量控制 发送窗口：在收到对方确认之前发送方最多可以发送多少个数据帧
     + 后退N帧（GBN） 发送窗口>1，接收窗口=1，接受方只允许按顺序接受帧
     + 选择重传（SR） 发送窗口>1，接收窗口=1，接收窗口不应超过序号范围的一半
7. 差错控制
   - 位错 发送方附带CRC冗余验证码，接受方检测是否出错，如果出错使用ARQ协议重传
   - 帧错 帧的丢失，重复，失序等，引入定时器和编号机制
   - 差错都是由噪声引起的，一类是信道固有的随机热噪声，可以通过提高信噪比减少；另一类外界的原因造成的冲击噪声，无法避免，使产生差错的重要原因
8. 海明码 纠错d位，需要码距位2d+1的编码方案；捡错d位，需要码距为d+1 （求异或）
9. 组帧 字符定界法（字符个数+帧的字符） 首尾定界法（使用特素字符放在开始和结尾） 比特填充的首尾定界
10. 信道利用率 一个发送周期内，发送数据的时间占发送周期（传输，传播，确认）的比率
11. 对于窗口大小为n的滑动窗口，最多可以有 n-1 帧已发送但没有确认
12. 介质访问控制 隔离同一信道上其他结点传送的信号
    - 信道划分介质访问控制 频分多路复用（FDM，保护频带） 时分多路复用（TDM，固定时间） 统计时分多路复用（STDM，按需分配） 波分多路复用（WDM） 码分多路复用（CDM，码分多址CDMA）
    - 随机访问介质访问控制 竞争使用信道
      + 纯ALOHA协议 一段时间未收到确认，就重传，重传策略：各站等待一段随机的时间
      + 时隙ALOHA协议 划分时隙，只能在时隙使用信道
      + CSMA协议（载波监听） 1-坚持（一直监听，忙则等待） 非坚持（忙则放弃监听一段时间后再监听） p-坚持（忙则放弃监听一段时间后再监听，空闲已p的概率发送）
      + CSMA/CD协议（载波监听/碰撞检测） 先听后发，边发边听，冲突停止（通过电缆中的电压检测，每个帧传输时间必须大于争用区，传输48bit的拥塞信号），随机重发（二进制指数退避算法，k=min[重传次数, 10]，从集合[0,1,2,3...\(2^k-1\)]中区一个数r，基本退避时间为2rt，t为争用区；重传16次还不能成功时，报错）
      + CSMA/CA协议（载波监听/碰撞避免） 尽量减少碰撞发生的概率，预约信道，ACK帧（规定时间收不到重发）
    - 轮询访问介质访问控制 帧在环上传送时，所有站点都转发此帧，直到此帧回到始发站，由始发站撤消该帧；目的站除了转发以外，还要设置响应比特指示已经收到此帧
13. TDM比FDM抗干扰能力强，FDM适合传输模拟信号，TDM适合传输数字信号
14. 局域网
    - 拓扑结构
      + 以太网 逻辑 总线型 物理 星型
      + 令牌环 逻辑 环形 物理 星型
      + FDDI光纤 逻辑 环形 物理 双环
    - 传输介质 双绞线 光纤等
    - 介质访问控制方式（最重要，决定局域网的技术特性） CSMA/CD 令牌环
    - IEEE 802 两层 逻辑链路控制LLC子层（向上，给网络层提供4种（+高速传送）不同的连接服务类型；差错控制；给帧加序号） 媒体介入控制MAC子层（向下，屏蔽对物理层的访问差异，组帧、拆帧、比特传输差错检测、透明传输）；以太网在局域网中取得垄断地位
15. 以太网 无连接无确认，不对发送帧编号，尽最大努力交付，不可靠服务
    - 传输介质
      + 10BASE-5 粗缆 总线型 500m 100结点
      + 10BASE-2 细缆 总线型 185m 30结点
      + 10BASE-T 非屏蔽双绞线 星型 100m 2结点
      + 10BASE-FL 光纤对 点对点 2
      + 100BASE-T 双绞线 星型 支持全双工
      + 1GB-T 支持全双工
      + 10GB-T 只支持全双工
    - MAC帧 MAC地址 唯一 6个十六进制数 高24位厂商代码，低24位厂商自行分配的网卡序列号
    - IP数据报传到数据链路层添加首部和尾部形成帧；帧传到物理层加上8B的前导码（前7B前同步码实现比特同步，后1B是帧开始定界符），IP数据报的长度最大为46（64-18）-1500
16. 无线局域网 IEEE-802.11 由一个基站和若干移动站构成基本服务集（BSS），本BSS内直接通信；BSS通过接入点（AP）连到主干分配系统（DS），通过门桥（Portal）连到另一BSS，又叫扩展服务集（ESS）
17. IEEE 802.11 数据帧有4种类型，IBSS，FromAP，ToAP，WDS ToAP：1.RA（BSSID）2.SA（Source）3.DA（DS）；基本上address1:接收端，address2:发送端，address3:ds 地址
18. 易错点 看清楚题目要求的是 有效数据传输率 还是 有效数据传输速率
19. 网卡只关注和比特相关的传输，因此既工作在数据链路层，又工作在物理层
20. 目的MAC地址等于本机的MAC地址的帧不会被发送到网络
21. 易错点 结点交换机在 *单个* 网络内转发分组，而路由器在多个网络中转发分组
22. 广域网涉及到物理层，数据链路层，网络层三层
    - PPP协议 串行线路的面向字节的协议
      + 由三个部分组成 1. 链路控制协议（LCP，向下），建立、配置和管理链路；2. 网络控制协议（NCP，向上），为网络层协议提供配置，建立逻辑连接；3. 一个将IP数据报封装到串行链路的方法，IP数据报就是PPP帧的数据部分，受MTU限制
      + 点对点，而不是总线型，不采用CSMA/CD协议，没有最短帧，所以数据报可以有0-1500个字节
      + 提供差错检测，但不提供纠错（只CRC校验）；不可靠的传输协议，无序号和确认机制
      + 只支持全双工
      + 两端可以使用不同的网络层协议，但仍使用一个PPP协议通信
      + 如果PPP在异步线路（默认），采用字节填充法；其他线路采用硬件完成比特填充
      + 比HDLC多一个2B的协议字段，0x0021时表示IP数据报
    - HDLC协议 高级数据链路控制协议 面向比特
      + 全双工通信，CRC检测，可靠通信，比特填充
      + 正常响应（从站只有接收到主站之后才能传输），异步平衡（每个复合站都可以向其他站传输），异步响应（从站没接收到主站也可以发送）
23. 网桥 工作在链路层的MAC子层（所以没有流量控制功能），可以隔绝碰撞域（本网段的数据传输不通过网桥），处理数据对象是帧，不可以隔绝广播域
    - 透明网桥 源LAN和目的LAN相同，丢弃；不同，转发；未知，扩散（除本机外）（自学习算法）
    - 源路由网桥 选择最佳路由，广播发送发现帧，目的站一一发送应答帧
    - 以太网交换机采用直通式（直接转发）和存储转发式（发现帧有错就丢弃）；网桥采用存储转发
    - 交换机可以在多个端口之间建立多个并发连接
    - 利用交换机实现虚拟局域网（VLAN），既可以隔离冲突域，也可以隔离广播域
24. 注意 一般情况下，存储转发类型的设备都可以进行协议转换，两个网段可以使用不同的协议
* 网络层
- 网络层采用标准化协议，但互联的网络可以是异构的
- 当分组到达路由器的速率接近R（链路带宽）时，平均时延增加，会有大量分组被丢弃，网络的吞吐量会骤降
- 流量控制和拥塞控制的区别：前者是发送端和接收端直接的调配；后者是网络调整使得子网可以传送需要传送的数据（开环：自适应调整；闭环：事先安排）
- IP层提供不可靠服务
- 路由器互联的网络中，要求网络的物理层，数据链路层，网络层的协议可以不同，但以上的协议需要相同
- 路由算法 静态路由算法（事先安排） 动态路由算法（距离向量算法（RIP算法，向周围结点发送信息） 链路状态路由算法（OSPF算法，泛洪法）） 层次路由（内部网关协议，外部网关协议（BGP））
- RIP协议，“好消息传的快，坏消息传的慢”，使得变化不能及时的被其他结点知道，导致“慢收敛”现象，是发生回路的根本原因
- IPv4
  + IP分组由首部和数据两部分组成，首部有固定20B和可变部分
  + 首部长度 4bit 单位：4B 最大值：15x4=60B
  + 总长度（首部和数据的总长度） 16bit 单位：1B 最大值：\(2^16-1=65535\)
  + 标识 每产生一个数据报就加1，同一数据报因长度过长而被分开的标识号相同
  + 标志 3bit MF（morefragment）=1，还有分片；DF（Dont fragment），不要分片
  + 片位移 13bit 某片在原分组中的相对位置，单位：8B
  + 首部校验和 只校验首部，不校验数据
  + 生存时间TTL 为0时分组需要被丢弃
  + 协议字段 6:TCP 17:UDP
  + 主机号全为0的标识本网络本身；主机号全为1的表示本网络的广播地址；32位全为1表示整个TCP/IP网络的广播地址
  + 网络号不能全为0，127.0.0.1不能被使用
  + NAT（网络地址转换，传输层） 1个A类：10.0.0.0-10.255.255.255；16个B类：172.16.0.0-172.31.255.255；256个C类：192.168.0.0-192.168.255.255
  + 无分类编址CIDR 最长前缀匹配
- 易错点 不同网络中传送时，MAC帧的源地址和目的地址要发送变化；而在网桥中传输时，源地址不发生变化，目的地址变化
- 普通路由器转发IP数据报时，不改变源IP地址和目的IP地址，NAT转换时一定要变IP地址
- ARP（地址解析）协议 网络层 使用目的地址为全1的MAC帧广播ARP请求分组，B收到后响应分组（单播），最后保存到高速缓存中
- DHCP（动态主机配置）协议 应用层 UDP 客户/服务机方式 客户机广播”发现“消息，服务器广播”提供“消息，客户机广播“请求”消息，服务器广播“确认”消息
- ICMP（网际控制报文）协议 IP层 差错报文（终点不可达，源点抑制，时间超过，参数问题，重定向） 询问报文（回送请求，时间戳请求，掩码地址请求，路由器询问）
  - 不发送ICMP差错报文的情况：ICMP差错报文，第一个分片之后的其他分片，组播地址，特殊地址（127）
  - PING 使用回送请求报文，工作在应用层，直接使用网络层的ICMP协议；traceroute使用时间超过报文
